{% extends 'base.html' %}

{% block title %} 상품 상세보기 {% endblock %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>

html,
body{
width:100%;
overflow-x:hidden;
}

div.zeronine {
  margin: 0 auto;
}


@media screen and (min-width: 601px) {
  div.container {
    margin: 0 auto;
  }
}



@media screen and (max-width: 600px) {
  .with {
      margin-top:30px;
      margin-bottom: 10px;
      width: 22%
  }
}

@media screen and (min-width: 601px) {
  .productimg {
      margin-left:100px;
      width:450px;
      margin-top: 90px;
  }
}

@media screen and (max-width: 600px) {
  .productimg {
      width:325%;
      text-align: center;
      margin-top: 20px;
      margin-left: 20px;
      position: relative;
  }
}

@media screen and (min-width: 601px) {
  .daybox {
      width: 80px;
      height: 80px;
      background-color: #637B46;
      position: absolute;
      float:left;
      margin-left: 120px;
      margin-top: -450px;
  }
}

@media screen and (max-width: 600px) {
  .daybox {
      width: 80px;
      height: 80px;
      background-color: #637B46;
      float:left;
      margin-left:20px;
      margin-top:-308px;
      position: relative;
  }
}

@media screen and (min-width: 601px) {
  .with {
      margin-top:30px;
      margin-bottom: 10px;
      width: 12%
  }
}

@media screen and (max-width: 600px) {
  .with2 {
    margin-bottom:80px;
      font-size: 17px;
  }
}

@media screen and (min-width: 601px) {
  .with2 {
    margin-bottom:80px;
  }
}

@media screen and (max-width: 601px) {
  div.zeronine3 {
    text-align: center;
    margin-left: -275px;
    margin-top: -120px;
  }
}


@media screen and (min-width: 601px) {
  div.col-sm-6 {
  }
}

@media screen and (max-width: 600px) {
  div.col-sm-6 {
    width: 50%;
    transform: translate(99%, -100%);
  }
}

table {border-collapse:collapse; width:100%;}

table a {color:#333; text-decoration:none;}
 .table-wrap table.board {
    font-family:'Noto Sans KR';
    text-align: center; }

.table-wrap table {
  position: relative;
  line-height: 1.4;
  table-layout: auto;
}

  .table-wrap table::before {
    content: "";
    width: 100%;
    height: 1px;
    background-color: #000;
    position: absolute;
    top: 0;
    left: 0;
  }

  .table-wrap table thead th {
    border: 1px solid #ddd;
    border-bottom: 0;
    background-color: #f9f9f9;
    padding: 20px;
    color: #222;
    font-size: .9rem;
    font-weight: 400;
  }

    .table-wrap table thead th:first-child {
      border-left: 0;
    }

    .table-wrap table thead th:last-child {
      border-right: 0;
    }

  .table-wrap table tbody th {
    border: 1px solid #ddd;
    background-color: #fcfcfc;
    padding: 20px;
    font-size: .8rem;
    font-weight: 400;
    color: #222;
  }

    .table-wrap table tbody th:first-child {
      border-left: 0;
    }

    .table-wrap table tbody th:last-child {
      border-right: 0;
    }

    .table-wrap table tbody th .list.dash > li {
      padding-left: 15px;
    }

      .table-wrap table tbody th .list.dash > li::before {
        left: 0;
      }

  .table-wrap table tbody td {
    border: 1px solid #ddd;
    padding: 20px;
    font-size: .8rem;
    font-weight: 400;
    background-color: #fff;
  }

    .table-wrap table tbody td:first-child {
      border-left: 0;
    }

    .table-wrap table tbody td:last-child {
      border-right: 0;
    }

@media (max-width: 600px) {
table {border-collapse:collapse; width:100%;}

table a {color:#333; text-decoration:none;}
 .table-wrap table.board {
    font-family:'Noto Sans KR';
    text-align: center; }

.table-wrap table {
  position: relative;
  line-height: 1.4;
  table-layout: auto;
}

  .table-wrap table::before {
    content: "";
    width: 100%;
    height: 1px;
    background-color: #000;
    position: absolute;
    top: 0;
    left: 0;
  }

  .table-wrap table thead th {
    border: 1px solid #ddd;
    border-bottom: 0;
    background-color: #f9f9f9;
    padding: 20px;
    color: #222;
    font-size: .9rem;
    font-weight: 400;
  }

    .table-wrap table thead th:first-child {
      border-left: 0;
    }

    .table-wrap table thead th:last-child {
      border-right: 0;
    }

  .table-wrap table tbody th {
    border: 1px solid #ddd;
    background-color: #fcfcfc;
    padding: 20px;
    font-size: .8rem;
    font-weight: 400;
    color: #222;
  }

    .table-wrap table tbody th:first-child {
      border-left: 0;
    }

    .table-wrap table tbody th:last-child {
      border-right: 0;
    }

    .table-wrap table tbody th .list.dash > li {
      padding-left: 15px;
    }

      .table-wrap table tbody th .list.dash > li::before {
        left: 0;
      }

  .table-wrap table tbody td {
    border: 1px solid #ddd;
    padding: 20px;
    font-size: .8rem;
    font-weight: 400;
    background-color: #fff;
  }

    .table-wrap table tbody td:first-child {
      border-left: 0;
    }

    .table-wrap table tbody td:last-child {
      border-right: 0;
    }

    .joinadress label {
        margin-right: 200px;
        width: 500px;
        text-align: left;
        margin-top: -10px;
    }

    .joinadress input[name="name"] {
        width: 140px;
        margin-bottom: 5px;
    }

    .joinadress input[name="phone"] {
        width: 140px;
        margin-bottom: 5px;
    }

    .joinadress input[name="address"] {
        width: 140px;
        margin-bottom: 5px;
    }

    .joinadress input[name="address2"] {
        width: 140px;
        margin-top: -15px;
    }

    .joinadress input[name="address3"] {
        width: 140px;
        margin-left: 150px;
        margin-top: -38px;
        margin-bottom: 20px;
    }


    .joinadress input[type="button"] {
        width: 100px;
        height:38px;
        border-radius: 3px;
        margin-left: 165px;
        margin-top: -38px;
        font-size: 14.5px;
    }

    @media screen and (max-width: 600px) {
        .pc {
            float: left;
            background:grey;
            color:white;
            border: none;
            border-radius: 3px;
            font-size: 14px;
            width: 100px;
            height: 35px;
        }
    }

}

    @media screen and (min-width: 601px) {
        .pc {
            margin-left:-7px;
            background:grey;
            color:white;
            border: none;
            border-radius: 3px;
            font-size: 14px;
        }
    }

    @media screen and (min-width: 601px) {
        .joinadress input[name="address2"] {
            margin-left: 122px;
            margin-top: 15px;
        }
    }

    @media screen and (min-width: 601px) {
        .joinadress input[name="address3"] {
            margin-left: 100px;
            margin-top: 15px;
        }
    }

    @media screen and (min-width: 601px) {
        .joinmodal {
            line-height: 1.6em;
            margin-top: 15px;
            font-size: 15px;
        }
    }

    @media screen and (max-width: 600px) {
        .joinmodal {
            line-height: 1.6em;
            margin-top: -30px;
            font-size: 12px;
        }
    }

    @media screen and (min-width: 601px) {
        .joinmodal2 {
            color: gray;
            font-size: 13px;
        }
    }

    @media screen and (max-width: 600px) {
        .joinmodal2 {
            color: gray;
            font-size: 12px;
        }
    }

    @media screen and (min-width: 601px) {
        .addressinfo {
            font-size:18px;
            margin-top:0px;
            margin-bottom:2px;
            margin-left:20px;
            text-align: left;
        }
    }

    @media screen and (max-width: 600px) {
        .addressinfo {
            font-size:18px;
            margin-top:40px;
            margin-bottom:2px;
            margin-left:20px;
            text-align: left;
        }
    }



.cart_table .cart_list li>div.opt_info .price_btn input {font-size: 0; margin-left: -1px; cursor: pointer; color: #ccc; width: 30px; height: 30px; border: 0; outline: 0; display: inline-block;text-align: center; vertical-align: top;background-size: cover !important;}
.cart_table .cart_list li>div.opt_info .price_btn input.minus_btn{background: url(https://tictoc-web.s3.ap-northeast-2.amazonaws.com/web/img/icon/btn_minus.svg) no-repeat center;}
.cart_table .cart_list li>div.opt_info .price_btn input.plus_btn{background: url(https://tictoc-web.s3.ap-northeast-2.amazonaws.com/web/img/icon/btn_plus.svg) no-repeat center;}
.cart_table .cart_list li>div.opt_info .price_btn input.number{font-size: 18px; background: #f5f5f5; color: #666; margin: 0 3px;}

</style>

 {% load static %}
    <link rel="stylesheet" href="{% static 'main.css' %}">
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<!-- 아래 제이쿼리는 1.0이상이면 원하는 버전을 사용하셔도 무방합니다. -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>


<div class="container">
<div class="zeronine">
    <div class="row">
        <div class="col-4">
            <div class="img">
              <img class="productimg" src="{{product.image.url}}">
                 <div class="daybox"><h2 style="font-size:18px; text-align:center; color: white; line-height: 78px;"><b>D-{{ delta_result }}</b></h2></div>
                      {% if delta_result < 0 %}
                      <div class="daybox" style="width: 80px; height: 80px; background-color: #637B46; position: absolute; margin-left: 120px; margin-top: -450px;"><p style="font-size:16px; text-align:center; color: white; line-height: 78px;"><b>모집종료</b></p></div>
                      {% endif %}
            </div>
        </div>

        <div class="zeronine3">
            <div class="text-center col" style="margin-top:150px; margin-left:200px;">
                <div class="box" style="width: 390px; margin-left: 102px; text-align: left;" >
                    <b><h5 id="productname" class="content" style="margin-right: 125px;"><b>{{product.name}}</b></h5></b><br>
                <div>
            </div>


            <hr style="width:75%; margin-right:100px; margin-top:-10px; margin-bottom: 30px; background-color:#BDBDBD;">
                <h7 style="color: #111111; margin-right: 200px; float: left;"><b>가격</b></h7>
                    {% load humanize %}
                     {% for designated in designated_object %}
                        {% if designated.product_code.product_code == product.product_code %}
                           <div id="price" style="display: none;">{{designated.price }}</div>
                          {{ designated.price | floatformat:'0' | intcomma }}원
                        {% endif %}
                     {% endfor %}
                 <br>

                <div class="hr" style="margin-top: 10px;">
                    <h7 style="color: #111111; margin-right: 162.2px; float: left;"><b>목표금액</b></h7>
                        {{ product.target_price | floatformat:'0' | intcomma }}원<br><br>
                </div>


        <form method="POST" action="{% url 'zeronine:join_create' id=product.product_code %}">
            <div class="form-group row" style="margin-top: -5px">
                <label for="optionSelect" class="col-sm-6 col-form-label"><b>옵션</b></label>
                    <div class="col-sm-6" style="margin-left: -90px;">

                        {% if not product.option_exists %}
                        <select type="text" class="form-control" id="optionSelect2">
                             <option value="none">옵션을 선택하세요.</option>
                             <option>옵션없음</option>
                        </select>

                        {% else %}

                       <select type="text" class="form-control" id="optionSelect">
                       <option value="none">옵션을 선택하세요.</option>
                       {% for option in option_object %}
                         {% if option.option_code.option_code == value.option_code %}
                             {% if option.product_code == product %}
                                 {% if option.name != '' %}
                                 <optgroup label="{{option.name}}">
                                 {% endif %}
                              {% endif %}

                         {% for value in value_object %}
                              {% if value.option_code.option_code == option.option_code %}
                                  {% if value.product_code == product %}
                                      {% if value.name != '' %}
                                            <option data-price="{{value.extra_cost}}" id="valueSelect" value="{{value.value_code}}">{{value.name}} (+{{value.extra_cost}}원)</option>
                                      {% endif %}
                                  {% endif %}
                              {% endif %}
                         {% endfor %}
                         {% endif %}
                       {% endfor %}
                    </optgroup>
                </select>
            {% endif %}

                    </div>
                 <div id="selectOptionList" style="margin-top:10px; margin-left: 20px; margin-bottom: -10px;">
                 </div>
        </div>

<script>
// optionSelect (옵션있는 상품)
$().ready(function() {
   $("#optionSelect").change(function() {
       var checkValue = $("#optionSelect").val();
       var checkText = $("#optionSelect option:selected").text();
       var $value = $("#optionSelect option:selected").val();
       var product = $("#productname").text();
       var price = parseInt($("#price").text());
       var test = parseInt($(this).find(':selected').data('price'));
       var hapgae = price + test

       if (checkValue != "no") {
           var whtml =
               "            <div class=\"cart_table\">\n" +
               "            <hr style='width: 290px; margin-right:50px; margin-bottom: 30px;'>" +
               "            <p style='font-size: 17px;'>" + product + "</p>" +
               "                <p style='font-size: 13px; margin-top: -10px; class=\"check\" margin-bottom: 20px;'>" + checkText + "</p>" +
               "             <span class=\"del_li_btn\" style='float: right; margin-right: 30px;'><img src=\"https://tictoc-web.s3.ap-northeast-2.amazonaws.com/web/img/icon/btn_del_circle.svg\" style='width: 80%;'></span>\n" +
               "            <ul class=\"cart_list\">\n" +
               "                <li style='list-style:none; margin-left: -38px;'>\n" +
               "                    <div class=\"opt_info\">\n" +
               "                        <strong style='display: none' class=\"price_unit\">" + hapgae + "</strong>\n" +
               "                        <div class=\"price_btn\">\n" +
               "                            <input type=\"button\" value=\"-\" class=\"minus_btn\">\n" +
               "                            <input style=\"width: 15%;\" type=\"text\" value=\"0\" class=\"number\" name=\"quantity\" id=\"quantity\">\n" +
               "                            <input type=\"button\" value=\"+\" class=\"plus_btn\">\n" +
               "                        </div>\n" +
               "                <div class=\"total_p\" style='margin-top:30px; margin-left: -2px;'>\n" +
               "                    <p style=\"font-size: 18px;\">가격<strong name=\"price3\" class=\"price_amount\" style=\"font-size: 18px; color: black; margin-left: 180px;\">" + 0 + "</strong>원\n" +
               "                     <input type='hidden' name=\"price2\" id=\"price2\">" +
               "                </div>\n" +
               "                   <input type='hidden' name=\"value_code2\" id=\"value_code2\" multiple>" +
               "                    </div>\n" +
               "                </li>\n" +
               "            </ul>" +
               "            </div>" +
               "\n" +
               "\n" +
               "        </div>"
           ;

           $("#selectOptionList").append(whtml)
       }

       $(document).ready(function () {
           $('.price_btn input[type="button"]').on('click', function () {
               var $ths = $(this);
               var $par = $ths.parent().parent();
               var $obj = $par.find('input[type="text"]');
               var val = $obj.val();

               if ($ths.val() == '-') {
                   if (val >= 2)
                       $obj.val(--val);

               } else if ($ths.val() == '+') {
                   if (val < 30)
                       $obj.val(++val);

               }

               //수량 변경
               var unit_amount = $par.find('.price_unit').text().replace(/[^0-9]/g, "");
               var quantity = val;
               pay_unit_func($par, unit_amount, quantity);
               pay_total_func();
           });

           function pay_unit_func($par, unit_amount, quantity) {
               //1번 단
               var unit_total_amount = $par.find('.price_amount').text((unit_amount * quantity).toLocaleString());
               var $input = $par.find('input[id="price2"]');
               var $price2 = parseInt($par.find('strong[name="price3"]').text().replace(/[^0-9]/g, ""));
               $input.val($price2);

               var $element = $par.find('input[id="value_code2"]');
               $element.val($value);
           }

           function pay_total_func() {
               //2번 단
               var amount_total = 0;
               var converse_unit = 0;
               $('.cart_list li').each(function () {
                   converse_unit = $(this).find('.price_amount').text().replace(/[^0-9]/g, "");
                   amount_total = amount_total + (parseInt(converse_unit) || 0);
               });

               var total_amount_money = $('.cart_total_price').children().find('.item_price').text(amount_total.toLocaleString());
               var total_total_price = $('.cart_total_price').children().find('.total_price').text(total_price.toLocaleString());

           }


        //개별 아이템 삭제
        $(document).ready(function() {
            $('.del_li_btn').on('click', function () {
                var recent_delete_cnt = $('.del_btn .num').text();
                var check_delete_ck = $(this).parent().find('div[class="price_btn"]');

                if (check_delete_ck == true) {
                    recent_delete_cnt = recent_delete_cnt - 1;
                    $('.del_btn .num').text(recent_delete_cnt);
                }

                $(this).parent().remove();
                pay_total_func();

            });
          });
        });
    });
});

// optionselect2 (옵션없는 상품)
$().ready(function() {
   $("#optionSelect2").change(function() {
       var checkValue = $("#optionSelect").val();
       var product = $("#productname").text();
       var price = parseInt($("#price").text());
       var hapgae = price

       if (checkValue != "no") {
           var whtml =
               "            <div class=\"cart_table\">\n" +
               "            <hr style='width:92%; margin-right:100px; margin-top:10px; margin-bottom: 30px;'>" +
               "            <p style='font-size: 17px;'>" + product + "</p>" +
               "             <span class=\"del_li_btn\" style='float: right; margin-right: 30px;'><img src=\"https://tictoc-web.s3.ap-northeast-2.amazonaws.com/web/img/icon/btn_del_circle.svg\" style='width: 80%;'></span>\n" +
               "            <ul class=\"cart_list\">\n" +
               "                <li style='list-style:none; margin-left: -38px;'>\n" +
               "                    <div class=\"opt_info\">\n" +
               "                        <strong style='display: none' class=\"price_unit\">" + hapgae + "</strong>\n" +
               "                        <div class=\"price_btn\">\n" +
               "                            <input type=\"button\" value=\"-\" class=\"minus_btn\">\n" +
               "                            <input style=\"width: 15%;\" type=\"text\" value=\"0\" class=\"number\" name=\"quantity\" id=\"quantity\">\n" +
               "                            <input type=\"button\" value=\"+\" class=\"plus_btn\">\n" +
               "                        </div>\n" +
               "                <div class=\"total_p\" style='margin-top:30px; margin-left: -2px;'>\n" +
               "                    <p style=\"font-size: 18px;\">가격<strong name=\"price3\" class=\"price_amount\" style=\"font-size: 18px; color: #849160; margin-left: 180px;\">" + 0 + "</strong>원\n" +
               "                     <input type='hidden' name=\"price2\" id=\"price2\">" +
               "                </div>\n" +
               "                    </div>\n" +
               "                </li>\n" +
               "            </ul>" +
               "            </div>" +
               "\n" +
               "\n" +
               "        </div>"
           ;

           $("#selectOptionList").append(whtml)

       }

       $(document).ready(function () {
           $('.price_btn input[type="button"]').on('click', function () {
               var $ths = $(this);
               var $par = $ths.parent().parent();
               var $obj = $par.find('input[type="text"]');
               var val = $obj.val();

               if ($ths.val() == '-') {
                   if (val >= 2)
                       $obj.val(--val);

               } else if ($ths.val() == '+') {
                   if (val < 30)
                       $obj.val(++val);

               }

               //수량 변경
               var unit_amount = $par.find('.price_unit').text().replace(/[^0-9]/g, "");
               var quantity = val;
               pay_unit_func($par, unit_amount, quantity);
               pay_total_func();
           });

           function pay_unit_func($par, unit_amount, quantity) {
               //1번 단
               var unit_total_amount = $par.find('.price_amount').text((unit_amount * quantity).toLocaleString());
               var $input = $par.find('input[id="price2"]');
               var $price2 = parseInt($par.find('strong[name="price3"]').text().replace(/[^0-9]/g, ""));
               $input.val($price2);

           }

           function pay_total_func() {
               //2번 단
               var amount_total = 0;
               var converse_unit = 0;
               $('.cart_list li').each(function () {
                   converse_unit = $(this).find('.price_amount').text().replace(/[^0-9]/g, "");
                   amount_total = amount_total + (parseInt(converse_unit) || 0);
               });

               var total_amount_money = $('.cart_total_price').children().find('.item_price').text(amount_total.toLocaleString());
               var total_total_price = $('.cart_total_price').children().find('.total_price').text(total_price.toLocaleString());

           }


        //개별 아이템 삭제
        $(document).ready(function() {
            $('.del_li_btn').on('click', function () {
                var recent_delete_cnt = $('.del_btn .num').text();
                var check_delete_ck = $(this).parent().find('div[class="price_btn"]');

                if (check_delete_ck == true) {
                    recent_delete_cnt = recent_delete_cnt - 1;
                    $('.del_btn .num').text(recent_delete_cnt);
                }

                $(this).parent().remove();
                pay_total_func();

            });
          });
        });
    });
});
</script>

            <hr style="width:75%; margin-right:100px; margin-top:30px; margin-bottom: 30px; background-color:#E6E6E6;">
            <div class="cart_total_price">
                <h2 style="font-size: 25px; color: #849160;"><p style="font-size: 19px; margin-top: 35px; margin-bottom: -25px; color: black;"><b>총 가격</b></p>
                    <strong id="item_price" class="item_price" style="margin-left: 220px; font-size: 23px; margin-bottom: 20px;">0</strong><span style="font-size: 23px; text-align: right; color: #849160;">원</span></h2>
            </div>

                {% csrf_token %}
                {% if not user.is_authenticated %}
                <a onclick="alert('로그인 후 참여가 가능합니다.');" style="cursor:pointer;">
                    <button type="submit" action="{% url 'zeronine:join_create' id=product.product_code %}" style="background:#637B46; border-color:#637B46; border-radius: 0px; text-align: center; width: 140px; height:45px; margin-left: 155px; margin-top: 40px;" class="btn btn-primary"><b>참여하기</b></button>
                </a>
                {% else %}
                <div style="margin-top: 40px;">
                    <button type="button" action="{% url 'zeronine:join_create' id=product.product_code %}" style="background: #637B46; border-color: #637B46; border-radius: 0px; text-align: center; width: 140px; height:45px; margin-left: 155px;" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter"><b>참여하기</b></button>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body" style="text-align: center">

      <h4 style="margin-top:20px; margin-bottom: 15px;"><b>상품 결제</b></h4><br>
    <div class="container">
        <div class="row">
        <div class="col-12">
            <p style="font-size:18px; tmargin-top:-5px; margin-bottom:10px; text-align: left">상품 정보</p>
        </div>
        </div>
     <div class="table-wrap">
    <table class="board all-open" style="margin-bottom: 10px;">

    <colgroup>
      <col style="width:20%; height: 10%">
        <col style="width:40%; height: 10%">
    </colgroup>

    <thead>
      <tr>
        <th scope="col">상품이미지</th>
        <th scope="col">상품명</th>
      </tr>
    </thead>
    <tbody>
      <tr>

        <td><img src="{{product.image.url}}" style="width:100px;"></td>
        <td style="font-size: 17px;">{{product.name}}</td>
      </tr>

    </tbody>
  </table>
</div>
 </div>

           <div class="cart_total_price" style="text-align: right; margin-right: 35px; margin-top:20px; margin-bottom: 18px;">
                <p style="font-size: 19px; margin-right: 100px;"><b>총 결제 금액</b></p>
                <div style="margin-top: -53px;"><h2><strong class="item_price" style="font-size: 19px;">0</strong><span style="font-size: 19px; color: black;">원</span></h2></div>

        <div class="row">
        <div class="col-12">
            <p class="addressinfo">배송지 정보</p>
        </div>
        </div>

            <hr width="97%" style="margin-top:8px; margin-left:20px; text-align: center; border: solid 0.5px; opacity: 10%;">
            <br>
    <article class="joinadress">
        <div class="form-group row" style="margin-left:15px">
            <label for="name" class="col-sm-2 col-form-label"><b>참여자명</b></label>
            <div class="col-sm-5">
            <input type="text" class="form-control" name="name" id="name"
                   value="{{ form.name.value|default_if_none:'' }}" placeholder="참여자 이름">
            </div>
        </div>

        <div class="form-group row" style="margin-left:15px">
            <label for="phone" class="col-sm-2 col-form-label"><b>전화번호</b></label>
            <div class="col-sm-5">
            <input type="text" class="form-control" name="phone" id="phone"
                   value="{{ form.phone.value|default_if_none:'' }}" placeholder="전화번호">
            </div>
        </div>

        <div class="form-group row" style="margin-left:15px">
            <label for="address" class="col-sm-2 col-form-label"><b>배송지</b></label>
            <div class="col-sm-5">
            <input type="text" class="form-control" name="address" id="sample4_postcode"
                   value="{{ form.address.value|default_if_none:'' }}" placeholder="우편번호">
            </div>

            <input class="pc" type="button" onclick="sample4_execDaumPostcode()" value="우편번호 검색"><br>

            <div class="col-sm-5">
            <input type="text" class="form-control" name="address2" id="sample4_roadAddress"
                   value="{{ form.phone.value|default_if_none:'' }}" placeholder="도로명 주소">
            </div>

            <div class="col-sm-5">
            <input type="text" class="form-control" name="address3" id="sample4_detailAddress"
                   value="{{ form.address2.value|default_if_none:'' }}" placeholder="상세주소"></div>
        </div>
    </article>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    //본 예제에서는 도로명 주소 표기 방식에 대한 법령에 따라, 내려오는 데이터를 조합하여 올바른 주소를 구성하는 방법을 설명합니다.
    function sample4_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var roadAddr = data.roadAddress; // 도로명 주소 변수
                var extraRoadAddr = ''; // 참고 항목 변수

                // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                    extraRoadAddr += data.bname;
                }
                // 건물명이 있고, 공동주택일 경우 추가한다.
                if(data.buildingName !== '' && data.apartment === 'Y'){
                   extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                if(extraRoadAddr !== ''){
                    extraRoadAddr = ' (' + extraRoadAddr + ')';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('sample4_postcode').value = data.zonecode;
                document.getElementById("sample4_roadAddress").value = roadAddr;

                // 참고항목 문자열이 있을 경우 해당 필드에 넣는다.
                if(roadAddr !== ''){
                    document.getElementById("sample4_extraAddress").value = extraRoadAddr;
                } else {
                    document.getElementById("sample4_extraAddress").value = '';
                }
            }
        }).open();
    }
</script>
        <div class="row">
        <div class="col-12">
            <p style="font-size:18px; margin-top:10px; margin-bottom:2px; margin-left:20px; text-align: left">결제 정보</p>
            <hr width="97%" style="margin-top:8px; margin-left:20px; text-align: center; border: solid 0.5px; opacity: 10%;">
            <br>
        </div>
        </div>
            </div>
            <p class="joinmodal">
               <b>유의사항 체크 후, 결제하기 버튼을 눌러 결제를 진행해주세요.<br>
                결제 완료 후, 확인 버튼을 눌러야 정상적인 참여가 가능합니다.<br>
                위 절차를 모두 진행하면, 마이페이지의 참여 내역에서 확인할 수 있습니다.</b>
            </p>
          <hr style="width: 7%; background: lightgrey; opacity: 50%;">
          <p class="joinmodal2">공동구매 상품 참여를 위해 최소한의 범위 내에서 위와 같이 개인정보를 수집, 이용합니다.<br>
              수집 및 이용에 동의하지 않으실 수 있으며 동의하지 않으실 경우, 구매가 제한될 수 있습니다.<br>
              내용에 동의하시면 확인 버튼을 눌러 참여를 진행해주세요.
          </p>
        <div>
        <label style="margin-bottom: 30px;">
            <input type="checkbox" name="ck" onClick="checkDisable(this.form)" style="width: 10px; height:10px;">
            <span style="font-size: 14px;">유의사항 동의</span>
        </label>
        </div>
        <button id="check_module" type="button" name="bt" disabled="true" style="margin-top:-15px; margin-bottom:30px; background: #637B46; color:white; border-color: #637B46; border-radius: 0px; text-align: center; width: 120px; height:45px;"  class="btn btn-primary"><b>결제하기</b></button>


    <script type="text/javascript">
        function checkDisable(form) {
            if (form.ck.checked == true) {
                form.bt.disabled = false;
            } else {
                form.bt.disabled = true;
            }
        }
    </script>
      </div>

      <div class="modal-footer">
        <button action="{% url 'zeronine:join_create' id=product.product_code %}" style="background:grey; border-color: white" class="btn btn-primary"><b>확인</b></button>
      </div>
    </div>
  </div>
</div>
                {% endif %}
                </div>
         </form>
<script>
$("#check_module").click(function () {
var price = parseInt($("#item_price").text().replace(/,/g , ''));
var IMP = window.IMP; // 생략가능
      IMP.init('imp72615144');
      IMP.request_pay({
          pg : 'kcp',
          pay_method : 'card',
          merchant_uid : 'merchant_' + new Date().getTime(),
          name : '{{product.name}}' , //결제창에서 보여질 이름
          amount : price, //실제 결제되는 가격
          buyer_email:$('input[name="email"]').val(),
          buyer_name : '{{user.username}}',
      }, function(rsp) {
         console.log(rsp);
          if ( rsp.success ) {
             var msg = '결제가 완료되었습니다.';
              msg += '고유ID : ' + rsp.imp_uid;
              msg += '상점 거래ID : ' + rsp.merchant_uid;
              msg += '결제 금액 : ' + rsp.paid_amount;
              msg += '카드 승인번호 : ' + rsp.apply_num;
          } else {
              var msg = '결제에 실패하였습니다.';
               msg += ' : ' + rsp.error_msg;
          }
          alert(msg);

      });
   });
</script>

        <form method="POST" action="{% url 'zeronine:add_zzim' id=product.product_code%}" style="margin-top: -85px; margin-left: 160px;">
                {% csrf_token %}
                {% if not user.is_authenticated %}
                <div style="margin-top: 40px; margin-right: 180px;">
                <a onclick="alert('로그인 후 찜하기가 가능합니다.');" style="cursor:pointer;">
                    <button type="submit" style="background:white; color:#4B610B; border-color: #637B46; width: 140px; height:45px; border-radius: 0px; text-align: center; margin-left: -320px;" class="btn btn-primary"><b>찜하기</b></button></a>

                  {% else %}
                <div style="margin-top: 40px;">
{#                <a onclick="alert('{{ product.name }} 상품을 찜했습니다.');" style="cursor:pointer;">#}
                <button type="button" action="{% url 'zeronine:add_zzim' id=product.product_code%}" style="background:white; color:#4B610B; border-color: #637B46; width: 140px; height:45px; border-radius: 0px; text-align: center; margin-left: -160px;" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalToggle"><b>찜하기</b></button>

<!-- Modal -->
<div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body" style="text-align: center">
          <img src="/static/img/heart.png" style="width: 11%; margin-top: 20px; margin-bottom: -15px;">
          <h4 style="font-size: 20px; margin-top: 35px;"><b>{{product.name}}</b> 상품을 찜했습니다.</h4>
          <p style="font-size: 16px; margin-top:5px;">찜한 상품은 <b>마이페이지 > 찜목록</b>에서 모아보실 수 있습니다.</p>
      </div>


      <div class="modal-footer">
        <button type="submit" action="{% url 'zeronine:add_zzim' id=product.product_code%}" style="background:grey; border-color: white" class="btn btn-primary"><b>확인</b></button>
      </div>
    </div>
  </div>
</div>
                  {% endif %}
                </div>
                </div>
         </form>
   </div>
</div>

<hr style="width: 80%; margin-top:40px; margin-bottom: 50px;">

 <div id="detail" class="container" style="width:67%; text-align: center; justify-content: center">

     <img class="with" src="/static/img/logo_.png" style="justify-content: center;">
     <h6 class="with2" style="justify-content: center; text-align: center">함께하는 공동구매, <b>제로나인</b></h6>

            <h4 style="justify-content: center; text-align: center; margin-bottom: 40px;"><b>[{{ product.name }}]</b></h4>
                <h6 class="hh" style="margin-top:20px; justify-content: center; text-align: center"><b>취지</b></h6>
                <p class="hh" style="margin-top:5px; justify-content: center; text-align: center">{{ product.benefit }}</p>

                <h6 class="hh" style="margin-top:30px; justify-content: center; text-align: center"><b>상품 설명</b></h6>
                <p class="hh" style="margin-top:5px; justify-content: center; text-align: center;">{{ product.detail }}</p>

                 <h6 class="hh" style="margin-top:30px; justify-content: center; text-align: center;"><b>모집 기간</b></h6>
                <p class="hh" style="margin-top:5px; margin-bottom: 50px; justify-content: center; text-align: center">{{ product.start_date }} ~ {{ product.due_date }}</p>

                </div>

             {% for photo in photo_object %}
                {% if photo.product_code.product_code == product.product_code %}
            <div class="col-12 text-center" style="display: inline-block;">
                <div class="photo" style="margin-bottom: 30px;">
                    <img style="width: 50%; margin-bottom: 30px;" src="{{photo.photo.url}}" alt="상품 이미지">
                </div>
            </div>

            {% endif %}
            {% endfor %}

            </div>
       </div>
    </div>
 </div>

{% endblock %}